<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invitación de Cumpleaños</title>
<link rel="stylesheet" href="styles.css">
</head>
   <!-- font awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anton&family=Oswald:wght@500&family=Russo+One&display=swap" rel="stylesheet">
<body>

<div class="invitation">
  <div class="header">
    <h1>¡Estás Invitado!</h1>
  </div>
  <div class="userData">
    <div id="userData"></div>
  </div>
  <div>
    <h4>En Snack Bowling</h4>
    <p>Avenida del libertador 13054 - Martinez</p>
  </div>
  <div class="countdown">
    <h2>¿Cuanto Falta?</h2>
    <p id="countdownTimer"></p>
  </div>
  <div class="footers">
    <button id="shareButton">Compartir por WhatsApp</button>
  </div>
</div>

<footer class="footer">
  <div class="footer__redes"> 
    <a href="https://instagram.com/snackbowling" target="_blank" class="logoFooter">
      <i class="fa-brands fa-instagram logo__footer"></i>
    </a>  
    <a href="https://facebook.com/snackbowling" target="_blank" class="logoFooter">
      <i class="fa-brands fa-facebook logo__footer"></i>
    </a>  
    <a href="https://www.linkedin.com/company/71763114/" target="_blank" class="logoFooter">
      <i class="fa-brands fa-linkedin logo__footer"></i>
    </a>  
  </div>
  <div class="footer__info ">
        <a href="https://www.google.com/maps/place/Snack+Bowling+%26+Restaurant/@-34.4907,-58.4855,15z/data=!4m2!3m1!1s0x0:0x4265a336265d66ed?sa=X&ved=2ahUKEwie0orZl7j5AhV4BLkGHdBvBt8Q_BJ6BAhzEAU" target="blanck">
          <i class="fa-solid fa-location-dot" style="color: white;"></i>
          Avenida del libertador 13054 - Martinez</a>            
        <a href="tel:47928009">
          <i class="fa-sharp fa-solid fa-phone"></i>
          4792-8009
        </a>
    </div>  
</footer>


<script>
window.onload = function() {
  // Obtener los parámetros de la URL
  var urlParams = new URLSearchParams(window.location.search);
  var userDataString = urlParams.get('data');
  
  // Decodificar los datos del usuario
  var userData = JSON.parse(decodeURIComponent(userDataString));

  // Formatear la fecha de inicio y fin
  var startDate = new Date(userData.birthday);
  var endDate = new Date(userData.birthday);
  startDate.setHours(parseInt(userData.time.split(':')[0]), parseInt(userData.time.split(':')[1]));
  endDate.setHours(startDate.getHours() + 2, parseInt(userData.time.split(':')[1]));

  // Formatear las horas
  var formattedStartTime = ('0' + startDate.getHours()).slice(-2) + ':' + ('0' + startDate.getMinutes()).slice(-2);
  var formattedEndTime = ('0' + endDate.getHours()).slice(-2) + ':' + ('0' + endDate.getMinutes()).slice(-2);

  // Mostrar los datos en la página
  var userDataElement = document.getElementById('userData');
  userDataElement.innerHTML = "<h3>" + userData.name + "</h3>" +
                               "<h4><strong>¡Te ha invitado a su cumple!</strong></h4>" +
                               "<h5>El día " + formatDate(startDate) + " de " + formattedStartTime + " hasta " + formattedEndTime + "</h5>";

// Calcular el tiempo restante hasta el cumpleaños
var today = new Date();
  startDate.setFullYear(today.getFullYear()); // Asegurarse de que el año del cumpleaños sea el mismo que el año actual
  
  if (today > startDate) {
    startDate.setFullYear(today.getFullYear() + 1); // Si ya pasó el cumpleaños, ajustar al próximo año
  }

  var timeLeft = startDate.getTime() - today.getTime();
  var daysLeft = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
  var hoursLeft = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

  // Mostrar el contador
  var countdownElement = document.getElementById('countdownTimer');
  countdownElement.textContent = "Faltan " + daysLeft + " días, " + hoursLeft + " horas, y " + minutesLeft + " minutos para el cumpleaños.";

  // Botón para compartir por WhatsApp
  var shareButton = document.getElementById('shareButton');
  shareButton.addEventListener('click', function() {
    // Obtener la URL base de la página actual
    var baseURL = window.location.href.split('?')[0];
    
    // Codificar los datos del usuario
    var encodedUserData = encodeURIComponent(JSON.stringify(userData));
    
    // Generar la URL completa con los datos codificados
    var completeURL = baseURL + '?data=' + encodedUserData;

    // Acortar la URL utilizando Bitly
    var accessToken = 'TU_ACCESS_TOKEN_DE_BITLY';
    var groupGuid = 'TU_GROUP_GUID_DE_BITLY'; // Puedes usar 'default' si no tienes grupos
    var bitlyURL = 'https://api-ssl.bitly.com/v4/shorten';
    
    fetch(bitlyURL, {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + accessToken,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        group_guid: groupGuid,
        long_url: completeURL
      })
    })
    .then(response => response.json())
    .then(data => {
      var shortURL = data.link;

      // Generar el enlace compartido por WhatsApp
      var whatsappMessage = "¡Estás invitado al cumpleaños de " + userData.name + "! Haz clic aquí para ver los detalles: " + shortURL;
      var encodedWhatsAppMessage = encodeURIComponent(whatsappMessage);
      var whatsappURL = "whatsapp://send?text=" + encodedWhatsAppMessage;
    
      // Abrir WhatsApp con el enlace compartido
      window.open(whatsappURL);
    })
    .catch(error => {
      console.error('Error al acortar la URL:', error);
      // Si hay un error al acortar la URL, simplemente compartir la URL completa
      var whatsappMessage = "¡Estás invitado al cumpleaños de " + userData.name + "! Haz clic aquí para ver los detalles: " + completeURL;
      var encodedWhatsAppMessage = encodeURIComponent(whatsappMessage);
      var whatsappURL = "whatsapp://send?text=" + encodedWhatsAppMessage;
    
      // Abrir WhatsApp con el enlace compartido
      window.open(whatsappURL);
    });
  });
}


// Función para formatear la fecha
function formatDate(date) {
  var day = ('0' + date.getDate()).slice(-2);
  var month = ('0' + (date.getMonth() + 1)).slice(-2);
  var year = date.getFullYear();
  return day + '/' + month + '/' + year;
}
</script>

      <!-- fontawesome -->
      <script src="https://kit.fontawesome.com/8cced7e539.js" crossorigin="anonymous"></script>

</body>
</html>
