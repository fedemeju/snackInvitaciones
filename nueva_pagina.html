<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invitación de Cumpleaños</title>
<link rel="stylesheet" href="styles.css">
</head>

<div class="relleno"></div>

<div class="image-container">
  <img src="snacky.png" alt="Imagen de invitación" class="invitation-image">
</div>
<div class="invitation">
  
  <div class="header">
  </div>
  <div class="userData">
    <div id="userData"></div>
  </div>
  <div class="details">
    <h4> ¡Snack Bowling!</h4>
    <p><strong>Dirección:</strong> Avenida del Libertador 13054, Martinez</p>
  </div>
  <div class="countdown">
    <h2>¿Cuánto Falta?</h2>
    <p id="countdownTimer"></p>
  </div>
  <div class="footers">
    <button id="shareButton">Compartir por WhatsApp</button>
  </div>
</div>

<footer class="footer">
  <div class="social-media">
    <a href="https://instagram.com/snackbowling" target="_blank"><i class="fab fa-instagram"></i></a>
    <a href="https://facebook.com/snackbowling" target="_blank"><i class="fab fa-facebook"></i></a>
    <a href="https://www.linkedin.com/company/71763114/" target="_blank"><i class="fab fa-linkedin"></i></a>
  </div>
  <div class="contact-info">
    <p><i class="fas fa-map-marker-alt"></i> Avenida del Libertador 13054 - Martinez</p>
    <p><i class="fas fa-phone"></i> 4792-8009</p>
  </div>
</footer>

<script>
window.onload = function() {
  // Obtener los parámetros de la URL
  var urlParams = new URLSearchParams(window.location.search);
  var userDataString = urlParams.get('data');
  
  // Decodificar los datos del usuario
  var userData = JSON.parse(decodeURIComponent(userDataString));

  // Formatear la fecha de inicio y fin
  var startDate = new Date(userData.birthday);
  var endDate = new Date(userData.birthday);
  startDate.setHours(parseInt(userData.time.split(':')[0]), parseInt(userData.time.split(':')[1]));
  endDate.setHours(startDate.getHours() + 2, parseInt(userData.time.split(':')[1]));

  // Formatear las horas
  var formattedStartTime = ('0' + startDate.getHours()).slice(-2) + ':' + ('0' + startDate.getMinutes()).slice(-2);
  var formattedEndTime = ('0' + endDate.getHours()).slice(-2) + ':' + ('0' + endDate.getMinutes()).slice(-2);

  // Mostrar los datos en la página
  var userDataElement = document.getElementById('userData');
  userDataElement.innerHTML = "<h3>" + userData.name + "</h3>" +
                               "<h4><strong>¡Te ha invitado a su cumple!</strong></h4>" +
                               "<h5>El día " + formatDate(startDate) + " de " + formattedStartTime + " hasta " + formattedEndTime + " en: </h5>";

  // Calcular el tiempo restante hasta el cumpleaños
  var today = new Date();
  startDate.setFullYear(today.getFullYear()); // Asegurarse de que el año del cumpleaños sea el mismo que el año actual
  if (today > startDate) {
    startDate.setFullYear(today.getFullYear() + 1); // Si ya pasó el cumpleaños, ajustar al próximo año
  }

  var timeLeft = startDate.getTime() - today.getTime();
  var daysLeft = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
  var hoursLeft = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
  
  // Mostrar el contador
  var countdownElement = document.getElementById('countdownTimer');
  countdownElement.textContent = "Faltan " + daysLeft + " días, " + hoursLeft + " horas, y " + minutesLeft + " minutos para el cumpleaños";

  + ".";

  // Botón para compartir por WhatsApp
  var shareButton = document.getElementById('shareButton');
  shareButton.addEventListener('click', function() {
    // Obtener la URL base de la página actual
    var baseURL = window.location.href.split('?')[0];
    
    // Codificar los datos del usuario
    var encodedUserData = encodeURIComponent(JSON.stringify(userData));
    
    // Generar la URL completa con los datos codificados
    var completeURL = baseURL + '?data=' + encodedUserData;

    // Acortar la URL utilizando un servicio de acortamiento
    var shortenerAPI = 'https://api.shrtco.de/v2/shorten?url=' + encodeURIComponent(completeURL);
    fetch(shortenerAPI)
      .then(response => response.json())
      .then(data => {
        var shortURL = data.result.short_link;

        // Generar el enlace compartido por WhatsApp
        var whatsappMessage = "¡Estás invitado al cumpleaños de " + userData.name + "! Haz clic aquí para ver los detalles: " + shortURL;
        var encodedWhatsAppMessage = encodeURIComponent(whatsappMessage);
        var whatsappURL = "whatsapp://send?text=" + encodedWhatsAppMessage;
      
        // Abrir WhatsApp con el enlace compartido
        window.open(whatsappURL);
      })
      .catch(error => {
        console.error('Error al acortar la URL:', error);
        // Si hay un error al acortar la URL, simplemente compartir la URL completa
        var whatsappMessage = "¡Estás invitado al cumpleaños de " + userData.name + "! Haz clic aquí para ver los detalles: " + completeURL;
        var encodedWhatsAppMessage = encodeURIComponent(whatsappMessage);
        var whatsappURL = "whatsapp://send?text=" + encodedWhatsAppMessage;
      
        // Abrir WhatsApp con el enlace compartido
        window.open(whatsappURL);
      });
  });
}

// Función para formatear la fecha
function formatDate(date) {
  var day = ('0' + date.getDate()).slice(-2);
  var month = ('0' + (date.getMonth() + 1)).slice(-2);
  var year = date.getFullYear();
  return day + '/' + month + '/' + year;
}

</script>

<!-- Agregar la biblioteca Font Awesome -->
<script src="https://kit.fontawesome.com/8cced7e539.js" crossorigin="anonymous"></script>

</body>
</html>

